---
title: 第 6 部分 - 测试和应用商店审批
description: 本文档介绍如何在设备上测试跨平台应用程序，如何管理测试用例，自动执行测试，运行单元测试，以及如何完成应用提交过程。
ms.prod: xamarin
ms.assetid: 46E0578A-7EB9-C105-ABB0-A043E501F36B
author: conceptdev
ms.author: crdun
ms.date: 03/23/2017
ms.openlocfilehash: bf6ea18c73226a620ce002797d2d2b04b48c7cc8
ms.sourcegitcommit: 76f930ce63b193ca3f7f85f768b031e59cb342ec
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/23/2019
ms.locfileid: "71198432"
---
# <a name="part-6---testing-and-app-store-approvals"></a>第 6 部分 - 测试和应用商店审批

## <a name="testing"></a>正在测试

许多应用程序（甚至是 Android 应用程序）在发布之前都必须传递审批过程;因此测试非常关键，可以确保您的应用程序进入市场（让您的客户独自成功）。 测试可以采用多种形式，从开发人员级单元测试到跨各种硬件管理 beta 测试。

### <a name="test-on-all-platforms"></a>针对所有平台进行测试

.NET 在 Windows phone、平板电脑和桌面设备上所支持的功能以及阻止动态生成动态代码的 iOS 上存在一些限制。 在开发时，计划在多个平台上测试代码，或计划在项目结束时重构和更新应用程序的模型部分。

使用模拟器/模拟器测试多个版本的操作系统以及不同的设备功能/配置始终是一种很好的做法。

你还应在尽可能多的物理硬件设备上进行测试。

#### <a name="devices-in-cloud"></a>云中的设备

移动电话和平板电脑生态系统一直在不断增长，因此无法在不断增加的可用设备上进行测试。 若要解决此问题，可以使用许多服务来远程控制多个不同的设备，以便可以在不需要直接投入大量硬件的情况下安装和测试应用程序。

[App Center 测试](https://docs.microsoft.com/appcenter/test-cloud/preparing-for-upload/uitest)提供一种简单的方法来测试数百台不同设备上的 IOS 和 Android 应用程序。

### <a name="test-management"></a>测试管理

在组织内测试应用程序或管理具有外部用户的测试版程序时，有两个难题：

- **分发**–管理预配过程（特别适用于 iOS 设备）并将软件的更新版本获取给测试人员。
- **反馈**–收集有关应用程序使用情况的信息，以及有关可能发生的任何错误的详细信息。

有许多服务可帮助解决这些问题，方法是提供内置于应用程序中的基础结构来收集和报告使用情况和错误，同时简化设置过程以帮助注册和管理测试人员及其设备.

[Visual Studio App Center](/appcenter/)提供了解决这些问题的解决方案，提供了测试版本分发、崩溃报告和复杂的应用程序使用情况信息。

### <a name="test-automation"></a>测试自动化

Xamarin [UITest](https://docs.microsoft.com/appcenter/test-cloud/preparing-for-upload/uitest)可用于创建可在本地运行或上载到[App Center 测试](https://docs.microsoft.com/appcenter/test-cloud/)的自动用户界面测试脚本。

## <a name="unit-testing"></a>单元测试

### <a name="touchunit"></a>触控单元

Xamarin 包括一个名为 Touch 的单元测试框架，该框架遵循 JUnit/NUnit 样式编写测试。

有关编写测试和运行 Touch 的详细信息，请参阅我们[的对 Xamarin iOS 文档的单元测试](~/ios/deploy-test/touch.unit.md)。

### <a name="andrunit"></a>Andr.Unit

有一个面向 Touch 的开源等效项，它称为 Andr。 可以从[github](https://github.com/spouliot/Andr.Unit)下载该工具，并在[ @spouliot博客](http://spouliot.wordpress.com/2011/10/30/andr-unit-joins-the-family/)上阅读有关该工具的信息。

## <a name="app-store-approvals"></a>App Store 审批

Apple 和 Microsoft 仅在其平台上操作应用商店：应用商店和 Marketplace。 同时锁定其设备并实现严格的应用审阅过程，以控制可供下载的应用程序的质量。 Android 的开放性质意味着可以使用多种存储选项，其中包括 Google Play （广泛提供并且没有审阅过程）到 Amazon Appstore 的 Android 和特定于硬件的工作并实现审批过程。

等待要查看的应用可能会造成极大的压力-业务压力通常意味着在 "目标" 启动日期之前，应用程序在发生错误时只需少量的利润。 此过程本身最多可能需要两周的时间，并且不一定是透明的：在最终拒绝或批准之前，对应用程序进度的反馈会受到限制。 拒绝可能意味着缺少商机市场营销活动，尤其是在发生多次时，以及在初始启动日期和应用最终批准时间之间的周数。

### <a name="be-prepared"></a>准备就绪

第一条建议：提前计划您的应用程序启动，并为可能的拒绝和重新提交进行补偿。 每个商店都需要在提交应用之前创建帐户-请尽快完成此操作。
尽管 Google Play 的注册只需几分钟的时间，但如果你的应用程序是免费的，则如果你要销售它们并需要提供银行和税务信息，该过程将更多地涉及。 Apple 和 Microsoft 的流程不仅涉及 Google，还可能需要一周或更长时间才能获得你的帐户批准，因此请将此时间转换成启动计划。

帐户获得批准后，即可提交应用。 以下文档介绍了提交应用的实际过程：

- [发布到 Apple 的 iOS 应用商店](~/ios/deploy-test/app-distribution/app-store-distribution/publishing-to-the-app-store.md)
- [为 Google Play 准备应用](~/android/deploy-test/publishing/publishing-to-google-play/index.md)
- Windows 开发人员应访问[Windows 开发人员中心](https://developer.microsoft.com/windows/windows-apps)，以了解如何提交其应用。

本部分的其余部分将讨论在没有任何短暂的情况下，应考虑的一些事项，以确保应用获得批准。

### <a name="quality"></a>质量

这听起来很明显，但应用程序通常会被拒绝，因为这些应用程序不能达到一定级别的质量：毕竟，这就是特选存储在一开始就有批准过程的原因！

崩溃是导致拒绝的常见原因。 如果应用崩溃非常简单，则一定要拒绝。 大多数开发人员都不会提交其应用程序，因为他们会发生故障，但它们常常会发生故障。 在提交应用之前对其进行全面测试，重点在于确保一切正常，同时还处理常见的移动错误方案，如网络问题和资源约束（如内存或存储空间）。 使用模拟器和物理设备进行测试-无论代码在模拟器中的运行情况如何，只有设备可以演示应用的实际性能。 使用任意数量的不同设备，并登记一组 beta-测试人员，前提是第三方服务可帮助管理 beta 分发和反馈。

所有移动操作系统都将终止无法快速启动的应用程序。 允许的时间长度不同，但是在常规应用程序中，应在几秒钟内做出响应，并使用后台任务完成需要更长时间的任何工作。 对于加载时间太长的应用程序，或在常规使用中没有响应能力的应用程序将被拒绝。 当后台发生某些事情时，始终提供用户反馈，否则应用程序将显示为已崩溃并再次出现故障。

### <a name="check-your-edge-cases"></a>检查边缘事例

开发人员的常见陷阱无法解决边缘情况，尤其是那些需要重新配置其模拟器或设备才能正常测试的情况。 很容易忘记，并非每个客户都将 "允许" 应用程序访问其位置，因为在开发人员接受请求一次后，将永远不会再次提示他们。 权限和网络使用情况在批准过程中特别 focussed，这意味着这些领域中的小监督可能会导致拒绝。

下面列出了一个很好的起点，用于检查可能已丢失的边缘事例：

- **客户可能会 "拒绝" 访问服务**-特别是在 iOS 中，仅当用户向应用程序授予权限时才会提供对数据的访问权限，如地理位置信息。 应用程序测试人员应经常在其初始状态中重新安装应用程序，并禁止任何权限请求，以确保应用程序的行为正确。 开启和关闭权限，以在客户改变主意时验证正确的行为。
- **客户在任何位置都**不会假定应用将仅用于开发它的城市或国家！ 适用于 GPS 坐标、日期和时间值和货币的代码可能会受到客户位置和区域设置的影响。 所有平台都提供了一个模拟器，可让你指定不同的位置和区域设置-使用它来测试其他半球中的位置，以及设置日期和货币格式的区域性。 纬度和经度值可以是正数或负数，小数分隔符可以是句点或逗号，并且可以通过多种方式设置日期的格式-处理！
- **网络连接缓慢**-应用程序开发人员经常在 "理想世界" 中工作，这在现实世界中明显不是工作网络连接。 使用慢速网络连接进行测试（例如3G 连接不当）以及无网络访问权限对于确保不提供有问题的应用程序至关重要。 审批流程将始终在飞机模式下包含一项与设备的测试，因此，请确保已对自己进行测试。
- **硬件变化**–请记住在计划支持的最早、最慢的硬件上进行测试。 可能会影响你的应用程序的两个方面：性能（可能无法在较旧的设备上使用），并支持硬件功能，如相机、麦克风、GPS、陀螺仪或其他可选组件。 当组件不可用时，应用程序应正常降级（而不是崩溃）。

### <a name="guidelines-are-more-than-just-a-guide"></a>准则不仅仅是 "指南"

Apple 非常著名，严格地遵守其平台的关键优势之一，因为其平台的关键优势之一是一致性（以及可感知的可用性增加）。 Microsoft 为实现[流畅设计系统](https://microsoft.com/design/fluent)的 Windows 应用程序采用了类似的方法。 这两个平台的审批流程都涉及到您的应用程序，使其遵守相关的设计理念。

这并不是说，用户界面创新不受支持，也不鼓励您这样做，但您不应该这样做，否则您的应用程序将被拒绝。

在 iOS 上，这包括滥用内置图标或以不一致的方式使用已建立良好的其他形式;例如，将 "撰写" 图标用于除了创建新内容以外的任何内容。

Windows 开发人员应同样小心;常见错误是无法根据 Microsoft 的指导原则正确支持硬件后退按钮。

鼓励设计人员阅读并遵循每个平台的设计指南。

### <a name="implementing-platform-specific-features"></a>实现特定于平台的功能

当涉及到实现特定于平台的服务时，尤其是在 iOS 上。 若要避免 Apple 自动拒绝，需要遵循以下 iOS 功能的规则：

- **应用内购买**–应用程序不得为包含游戏货币、应用程序功能、杂志订阅和其他内容的数字产品实现外部支付机制。 iOS 应用必须使用 Apple 的基于 iTunes 的服务来实现此类功能。 有一个漏洞的应用程序（如 Kindle 读取器和一些基于订阅的应用）允许你在附加到 "帐户" 的其他位置购买内容，然后你可以通过应用来访问该帐户，但在这种情况下，应用不得包含指向应用外购买过程（或再次拒绝应用程序）。
- **icloud 备份**-随着 icloud 的出现，Apple 的审阅者更严格地了解应用如何使用存储（以确保客户的远程备份体验令人愉快）。 可能会拒绝浪费备份存储空间的应用程序，因此请适当地使用缓存文件夹，并遵循 Apple 的其他与存储相关的准则。
- **Newsstand** –报纸和杂志应用非常适合 Apple 的 Newsstand，但应用必须实现至少一个自动续订订阅，并支持后台下载才能获得批准。
- **Maps** -向移动地图添加叠加和其他功能的情况越来越常见，但请注意不要掩盖地图 "信用" 信息（如 iOS5 中的 Google 徽标），因为这样会导致拒绝。

### <a name="manage-your-metadata"></a>管理元数据

除了可能导致应用程序被拒绝的明显技术问题之外，你的提交的一些更微妙的方面可能会导致拒绝，尤其是围绕你的提交应用程序以在应用商店或 Marketplace 内显示。

- **图像**–遵循平台的应用程序图标和存储图片的指导原则。 请勿使用商标字映像，因此，我们看到了应用被拒绝，因为其图标有一个 iPhone 的绘图！
- **商标**–避免使用您自己的任何商标。 已拒绝应用程序中提及的商标或 Apple App Store 上的关键字中的应用。
- **说明**–不要使用 "beta" 一词，或以任何方式指示该应用程序未准备好进行优化。 不要提及其他移动平台（即使您的应用程序是跨平台的）。 最重要的是，请确保应用程序执行的操作完全正确。 如果你在描述中列出了一系列功能，就更好地了解如何使用其中的每项功能，或者你将会收到 "未实现应用程序说明中提到的功能" 的拒绝。

在应用程序的元数据中投入大量精力作为开发和测试。 在元数据中，应用程序确实会被 infringements，因此，有必要花时间获得正确的时间。

### <a name="app-stores-not-for-everyone"></a>应用商店：并非适用于所有人

每个平台上的商店的主要重点是使用者分布，这就是尽可能多的客户。 但并不是所有的应用程序都以使用者为目标，而是需要向员工、供应商或客户提供有限限制的内部和 extranet 式应用程序的基础。 这些应用程序不是 "销售"，不需要审批，因为开发人员控制向一组已关闭的用户分发。
对此类部署的支持因平台而异。

Android 在这方面提供了最大的灵活性：可以直接从 URL 或电子邮件附件安装应用程序（只要设备的配置允许这样做）。 这意味着，创建和分发内部企业应用程序或将应用程序发布到特定客户或供应商是很简单的。

Apple 为在 iOS 开发人员企业计划中注册的开发人员提供内部部署选项，这会绕过应用商店批准过程，并允许公司将内部应用分发给其员工。
遗憾的是，此许可证不能满足与其他已关闭的客户或供应商组相似的应用程序分发的需求。 [企业（和即席）部署](~/ios/deploy-test/app-distribution/ipa-support.md)

### <a name="app-store-summary"></a>App Store 摘要

审查过程可能会很困难，但就像开发生命周期的其余部分一样，你可以通过进行一些规划和关注细节来帮助确保成功。 这一切都是几个简单的步骤：阅读并了解你必须遵守的用户界面准则，如果你要实现特定于平台的功能、进行彻底测试（再测试更多），最后确保你的应用程序元数据在提交之前是正确的。

Google Play 上发布的开发人员的最后一词建议：缺乏审批过程可能会使你的工作更加轻松，但你的客户将比审查团队更严格。 遵循这些指导原则，因为你的应用程序可能会被拒绝。
